# MYSQL中CHAR和VARCHAR的区别 #

# 答案 #

CHAR和VARCHAR看起来是一样的，实际上它们的存储和获取方式都不同。首先它们的长度是不同的；还有，他们对末尾空格的处理方式也不同。  

CHAR和VARCHAR类型的字段在申明的时候必须指定最大存储长度，如:`CHAR(30)`，指定的是该字段存储的最大长度是30个字符。  

一旦创建表的时候指定了CHAR字段的长度，那么它所存储的长度就是固定的，CHAR类型的字段的长度可以是0到255；如果存储的内容长度没有申明时的长度大，那么将会在这个数据末尾填充空格，如：申明`CHAR(120)`，而实际存入的是`"THIS IS STRING"`，那么MYSQL在存储时，将在`"THIS IS A STRING"`后面填充空格以达到120的长度；当需要把这条记录从MYSQL中取出的时候，它会自动被删掉后面的空格而变成`"THIS IS A STRING"`，除非开启了[PAD_CHAR_TO_FULL_LENGTH](HTTPS://DEV.MYSQL.COM/DOC/REFMAN/5.7/EN/SQL-MODE.HTML#SQLMODE_PAD_CHAR_TO_FULL_LENGTH)模式。

VARCHAR字段中的字符串长度是可变的，它的长度可以从0到65535。VARCHAR的有效长度受最大记录行(所有列之间共享65535字节)和所使用的字符集影响。  
和CHAR不同，VARCHAR的存储值为1字节或2字节再加上存储的数据，前缀的字节长度表明存储数据的长度，如果值不超过255个字节，则该列使用一个长度字节，如果值可能需要超过255个字节，则使用两个长度字节。

不管是CHAR还是VARCHAR，在没有开启严格模式(STRICT MODE)的时候，如果值的长度超过申明的长度，那么这个所存储的值将会被截断，同时MYSQL会发出警告。为了截断非空格字符，可能会导致错误发生（而不是一个警告），并通过使用严格的SQL模式来抑制阻止这个值的插入(例如最后一个字符是UTF8多字节字符，如中文字)。  

对于VARCHAR列，不管使用的SQL模式如何，在插入之前都会截断超出列长度的尾随空格，并生成警告。 对于CHAR列，无论SQL模式如何，都会以静默方式执行截断从插入值的多余的尾随空格。  

存储VARCHAR值时不填补。 根据标准SQL存储和检索值时，将保留尾随空格。

---

下面是一个例子：

| Value	 | CHAR(4)   | Storage Required | VARCHAR(4)  | Storage Required  |
| -----     | :-------: | :--------------: | :---------: | :---------------: |
| ''        | '    '    | 4 字节           | ''          | 1字节             |
| 'ab'      | 'ab  '    | 4 字节           | 'ab'        | 3字节             |
| 'abc'     | 'abc '    | 4 字节           | 'abc'       | 4字节             |
| 'abcd'    | 'abcd'    | 4 字节           | 'abcd'      | 5字节             |

InnoDB将长度大于或等于768字节的固定长度字段编码为可变长度的字段，可以将其存储在页面外。 例如，如果字符集的最大字节长度大于3，则CHAR(255)列可以超过768字节，就像使用utf8mb4一样。
